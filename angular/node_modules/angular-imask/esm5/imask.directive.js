/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Input, Output, forwardRef, Renderer2, EventEmitter, Optional, Inject, } from '@angular/core';
import { NG_VALUE_ACCESSOR, COMPOSITION_BUFFER_MODE } from '@angular/forms';
import { ɵgetDOM as getDOM } from '@angular/platform-browser';
// TODO import only types when ts 3.8 released or when move IMask to ts
import IMask from 'imask';
/**
 * @return {?}
 */
function _isAndroid() {
    /** @type {?} */
    var userAgent = getDOM() ? getDOM().getUserAgent() : '';
    return /android (\d+)/.test(userAgent.toLowerCase());
}
/** @type {?} */
export var MASKEDINPUT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return IMaskDirective; })),
    multi: true
};
/** @type {?} */
var DEFAULT_IMASK_ELEMENT = (/**
 * @param {?} elementRef
 * @return {?}
 */
function (elementRef) { return elementRef.nativeElement; });
var ɵ0 = DEFAULT_IMASK_ELEMENT;
/**
 * @template Opts
 */
var IMaskDirective = /** @class */ (function () {
    function IMaskDirective(_elementRef, _renderer, _compositionMode) {
        this._elementRef = _elementRef;
        this._renderer = _renderer;
        this._compositionMode = _compositionMode;
        // init here to support AOT (TODO may be will work with ng-packgr - need to check)
        this.onTouched = (/**
         * @return {?}
         */
        function () { });
        this.onChange = (/**
         * @return {?}
         */
        function () { });
        this.imaskElement = DEFAULT_IMASK_ELEMENT;
        this.accept = new EventEmitter();
        this.complete = new EventEmitter();
        this._viewInitialized = false;
        this._composing = false;
        this._writing = false;
        if (this._compositionMode == null) {
            this._compositionMode = !_isAndroid();
        }
    }
    Object.defineProperty(IMaskDirective.prototype, "element", {
        get: /**
         * @return {?}
         */
        function () {
            return this.imaskElement(this._elementRef, this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IMaskDirective.prototype, "maskValue", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this.maskRef)
                return this.element.value;
            if (this.unmask === 'typed')
                return this.maskRef.typedValue;
            if (this.unmask)
                return this.maskRef.unmaskedValue;
            return this.maskRef.value;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (this.maskRef) {
                if (this.unmask === 'typed')
                    this.maskRef.typedValue = value;
                else if (this.unmask)
                    this.maskRef.unmaskedValue = value;
                else
                    this.maskRef.value = value;
            }
            else {
                this._renderer.setProperty(this.element, 'value', value);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    IMaskDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (this.imask)
            this.initMask();
        this._viewInitialized = true;
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    IMaskDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.elementRef && !this.imaskElement)
            this.imaskElement = DEFAULT_IMASK_ELEMENT;
        if (!changes.imask || !this._viewInitialized)
            return;
        if (this.imask) {
            if (this.maskRef)
                this.maskRef.updateOptions(this.imask);
            else {
                this.initMask();
                this.onChange(this.maskValue);
            }
        }
        else {
            this.destroyMask();
        }
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype.destroyMask = /**
     * @return {?}
     */
    function () {
        if (this.maskRef) {
            this.maskRef.destroy();
            delete this.maskRef;
        }
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroyMask();
        this.accept.complete();
        this.complete.complete();
    };
    /**
     * @param {?} value
     * @return {?}
     */
    IMaskDirective.prototype.beginWrite = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this._writing = true;
        this._writingValue = value;
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype.endWrite = /**
     * @return {?}
     */
    function () {
        this._writing = false;
        return this._writingValue;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    IMaskDirective.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        value = value == null ? '' : value;
        if (this.maskRef) {
            this.beginWrite(value);
            if (this.maskValue !== value ||
                // handle cases like Number('') === 0,
                // for details see https://github.com/uNmAnNeR/imaskjs/issues/134
                (typeof value !== 'string' && this.maskRef.value === '') &&
                    !this.maskRef.el.isActive) {
                this.maskValue = value;
            }
        }
        else {
            this._renderer.setProperty(this.element, 'value', value);
        }
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype._onAccept = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var value = this.maskValue;
        // if value was not changed during writing don't fire events
        // for details see https://github.com/uNmAnNeR/imaskjs/issues/136
        if (this._writing && value === this.endWrite())
            return;
        this.onChange(value);
        this.accept.emit(value);
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype._onComplete = /**
     * @return {?}
     */
    function () {
        this.complete.emit(this.maskValue);
    };
    /**
     * @private
     * @return {?}
     */
    IMaskDirective.prototype.initMask = /**
     * @private
     * @return {?}
     */
    function () {
        this.maskRef = IMask(this.element, (/** @type {?} */ (this.imask)))
            .on('accept', this._onAccept.bind(this))
            .on('complete', this._onComplete.bind(this));
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    IMaskDirective.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this._renderer.setProperty(this.element, 'disabled', isDisabled);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    IMaskDirective.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) { this.onChange = fn; };
    /**
     * @param {?} fn
     * @return {?}
     */
    IMaskDirective.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) { this.onTouched = fn; };
    /**
     * @param {?} value
     * @return {?}
     */
    IMaskDirective.prototype._handleInput = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        // if mask is attached all input goes throw mask
        if (this.maskRef)
            return;
        if (!this._compositionMode || (this._compositionMode && !this._composing)) {
            this.onChange(value);
        }
    };
    /**
     * @return {?}
     */
    IMaskDirective.prototype._compositionStart = /**
     * @return {?}
     */
    function () { this._composing = true; };
    /**
     * @param {?} value
     * @return {?}
     */
    IMaskDirective.prototype._compositionEnd = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this._composing = false;
        this._compositionMode && this._handleInput(value);
    };
    IMaskDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[imask]',
                    host: {
                        '(input)': '_handleInput($event.target.value)',
                        '(blur)': 'onTouched()',
                        '(compositionstart)': '_compositionStart()',
                        '(compositionend)': '_compositionEnd($event.target.value)'
                    },
                    providers: [MASKEDINPUT_VALUE_ACCESSOR]
                },] }
    ];
    /** @nocollapse */
    IMaskDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: Boolean, decorators: [{ type: Optional }, { type: Inject, args: [COMPOSITION_BUFFER_MODE,] }] }
    ]; };
    IMaskDirective.propDecorators = {
        imask: [{ type: Input }],
        unmask: [{ type: Input }],
        imaskElement: [{ type: Input }],
        accept: [{ type: Output }],
        complete: [{ type: Output }]
    };
    return IMaskDirective;
}());
export { IMaskDirective };
if (false) {
    /** @type {?} */
    IMaskDirective.prototype.maskRef;
    /** @type {?} */
    IMaskDirective.prototype.onTouched;
    /** @type {?} */
    IMaskDirective.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._viewInitialized;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._composing;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._writingValue;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._writing;
    /** @type {?} */
    IMaskDirective.prototype.imask;
    /** @type {?} */
    IMaskDirective.prototype.unmask;
    /** @type {?} */
    IMaskDirective.prototype.imaskElement;
    /** @type {?} */
    IMaskDirective.prototype.accept;
    /** @type {?} */
    IMaskDirective.prototype.complete;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._elementRef;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    IMaskDirective.prototype._compositionMode;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hc2suZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1pbWFzay8iLCJzb3VyY2VzIjpbImltYXNrLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQVksU0FBUyxFQUNyRSxZQUFZLEVBQ1osUUFBUSxFQUFFLE1BQU0sR0FDakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3Qix1QkFBdUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xHLE9BQU8sRUFBRSxPQUFPLElBQUksTUFBTSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7O0FBRTlELE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQzs7OztBQUcxQixTQUFTLFVBQVU7O1FBQ1gsU0FBUyxHQUFHLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUN6RCxPQUFPLGVBQWUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7QUFDdkQsQ0FBQzs7QUFHRCxNQUFNLEtBQU8sMEJBQTBCLEdBQWE7SUFDbEQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsY0FBTSxPQUFBLGNBQWMsRUFBZCxDQUFjLEVBQUM7SUFDN0MsS0FBSyxFQUFFLElBQUk7Q0FDWjs7SUFFSyxxQkFBcUI7Ozs7QUFBRyxVQUFDLFVBQWUsSUFBSyxPQUFBLFVBQVUsQ0FBQyxhQUFhLEVBQXhCLENBQXdCLENBQUE7Ozs7O0FBQzNFO0lBeUJFLHdCQUFvQixXQUF1QixFQUN2QixTQUFvQixFQUN5QixnQkFBeUI7UUFGdEUsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUFDdkIsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUN5Qixx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LEtBQUs7eUJBQ0wsTUFBTTsyQkFDTixNQUFNOztJQW1KVCxxQkFBQztDQUFBLEFBMUtELElBMEtDO1NBaEtZLGNBQWM7OztJQUN6QixpQ0FBZ0M7O0lBQ2hDLG1DQUFlOztJQUNmLGtDQUFjOzs7OztJQUNkLDBDQUFrQzs7Ozs7SUFDbEMsb0NBQTRCOzs7OztJQUM1Qix1Q0FBMkI7Ozs7O0lBQzNCLGtDQUEwQjs7SUFFMUIsK0JBQXNCOztJQUN0QixnQ0FBa0M7O0lBQ2xDLHNDQUF3Rjs7SUFDeEYsZ0NBQW9DOztJQUNwQyxrQ0FBc0M7Ozs7O0lBRTFCLHFDQUErQjs7Ozs7SUFDL0IsbUNBQTRCOzs7OztJQUM1QiwwQ0FBOEUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCwgZm9yd2FyZFJlZiwgUHJvdmlkZXIsIFJlbmRlcmVyMixcclxuICBFdmVudEVtaXR0ZXIsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LFxyXG4gIE9wdGlvbmFsLCBJbmplY3QsIFNpbXBsZUNoYW5nZXMsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgQ09NUE9TSVRJT05fQlVGRkVSX01PREUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IMm1Z2V0RE9NIGFzIGdldERPTSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG4vLyBUT0RPIGltcG9ydCBvbmx5IHR5cGVzIHdoZW4gdHMgMy44IHJlbGVhc2VkIG9yIHdoZW4gbW92ZSBJTWFzayB0byB0c1xyXG5pbXBvcnQgSU1hc2sgZnJvbSAnaW1hc2snO1xyXG5cclxuXHJcbmZ1bmN0aW9uIF9pc0FuZHJvaWQoKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgdXNlckFnZW50ID0gZ2V0RE9NKCkgPyBnZXRET00oKS5nZXRVc2VyQWdlbnQoKSA6ICcnO1xyXG4gIHJldHVybiAvYW5kcm9pZCAoXFxkKykvLnRlc3QodXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IE1BU0tFRElOUFVUX1ZBTFVFX0FDQ0VTU09SOiBQcm92aWRlciA9IHtcclxuICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBJTWFza0RpcmVjdGl2ZSksXHJcbiAgbXVsdGk6IHRydWVcclxufTtcclxuXHJcbmNvbnN0IERFRkFVTFRfSU1BU0tfRUxFTUVOVCA9IChlbGVtZW50UmVmOiBhbnkpID0+IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbaW1hc2tdJyxcclxuICBob3N0OiB7XHJcbiAgICAnKGlucHV0KSc6ICdfaGFuZGxlSW5wdXQoJGV2ZW50LnRhcmdldC52YWx1ZSknLFxyXG4gICAgJyhibHVyKSc6ICdvblRvdWNoZWQoKScsXHJcbiAgICAnKGNvbXBvc2l0aW9uc3RhcnQpJzogJ19jb21wb3NpdGlvblN0YXJ0KCknLFxyXG4gICAgJyhjb21wb3NpdGlvbmVuZCknOiAnX2NvbXBvc2l0aW9uRW5kKCRldmVudC50YXJnZXQudmFsdWUpJ1xyXG4gIH0sXHJcbiAgcHJvdmlkZXJzOiBbTUFTS0VESU5QVVRfVkFMVUVfQUNDRVNTT1JdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJTWFza0RpcmVjdGl2ZTxPcHRzIGV4dGVuZHMgSU1hc2suQW55TWFza2VkT3B0aW9ucz4gaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xyXG4gIG1hc2tSZWY/OiBJTWFzay5JbnB1dE1hc2s8T3B0cz47XHJcbiAgb25Ub3VjaGVkOiBhbnk7XHJcbiAgb25DaGFuZ2U6IGFueTtcclxuICBwcml2YXRlIF92aWV3SW5pdGlhbGl6ZWQ6IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSBfY29tcG9zaW5nOiBib29sZWFuO1xyXG4gIHByaXZhdGUgX3dyaXRpbmdWYWx1ZTogYW55O1xyXG4gIHByaXZhdGUgX3dyaXRpbmc6IGJvb2xlYW47XHJcblxyXG4gIEBJbnB1dCgpIGltYXNrPzogT3B0cztcclxuICBASW5wdXQoKSB1bm1hc2s/OiBib29sZWFufCd0eXBlZCc7XHJcbiAgQElucHV0KCkgaW1hc2tFbGVtZW50OiAoZWxlbWVudFJlZjogRWxlbWVudFJlZiwgZGlyZWN0aXZlUmVmOiBhbnkpID0+IElNYXNrLk1hc2tFbGVtZW50O1xyXG4gIEBPdXRwdXQoKSBhY2NlcHQ6IEV2ZW50RW1pdHRlcjxhbnk+O1xyXG4gIEBPdXRwdXQoKSBjb21wbGV0ZTogRXZlbnRFbWl0dGVyPGFueT47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICAgICAgICBAT3B0aW9uYWwoKSBASW5qZWN0KENPTVBPU0lUSU9OX0JVRkZFUl9NT0RFKSBwcml2YXRlIF9jb21wb3NpdGlvbk1vZGU6IGJvb2xlYW4pIHtcclxuICAgIC8vIGluaXQgaGVyZSB0byBzdXBwb3J0IEFPVCAoVE9ETyBtYXkgYmUgd2lsbCB3b3JrIHdpdGggbmctcGFja2dyIC0gbmVlZCB0byBjaGVjaylcclxuICAgIHRoaXMub25Ub3VjaGVkID0gKCkgPT4ge307XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gKCkgPT4ge307XHJcbiAgICB0aGlzLmltYXNrRWxlbWVudCA9IERFRkFVTFRfSU1BU0tfRUxFTUVOVDtcclxuICAgIHRoaXMuYWNjZXB0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHRoaXMuX3ZpZXdJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5fY29tcG9zaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLl93cml0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NvbXBvc2l0aW9uTW9kZSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX2NvbXBvc2l0aW9uTW9kZSA9ICFfaXNBbmRyb2lkKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgZWxlbWVudCAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbWFza0VsZW1lbnQodGhpcy5fZWxlbWVudFJlZiwgdGhpcyk7XHJcbiAgfVxyXG5cclxuICBnZXQgbWFza1ZhbHVlICgpOiBhbnkge1xyXG4gICAgaWYgKCF0aGlzLm1hc2tSZWYpIHJldHVybiB0aGlzLmVsZW1lbnQudmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMudW5tYXNrID09PSAndHlwZWQnKSByZXR1cm4gdGhpcy5tYXNrUmVmLnR5cGVkVmFsdWU7XHJcbiAgICBpZiAodGhpcy51bm1hc2spIHJldHVybiB0aGlzLm1hc2tSZWYudW5tYXNrZWRWYWx1ZTtcclxuICAgIHJldHVybiB0aGlzLm1hc2tSZWYudmFsdWU7XHJcbiAgfVxyXG5cclxuICBzZXQgbWFza1ZhbHVlICh2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAodGhpcy5tYXNrUmVmKSB7XHJcbiAgICAgIGlmICh0aGlzLnVubWFzayA9PT0gJ3R5cGVkJykgdGhpcy5tYXNrUmVmLnR5cGVkVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgZWxzZSBpZiAodGhpcy51bm1hc2spIHRoaXMubWFza1JlZi51bm1hc2tlZFZhbHVlID0gdmFsdWU7XHJcbiAgICAgIGVsc2UgdGhpcy5tYXNrUmVmLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsZW1lbnQsICd2YWx1ZScsIHZhbHVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmICh0aGlzLmltYXNrKSB0aGlzLmluaXRNYXNrKCk7XHJcblxyXG4gICAgdGhpcy5fdmlld0luaXRpYWxpemVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzLmVsZW1lbnRSZWYgJiYgIXRoaXMuaW1hc2tFbGVtZW50KSB0aGlzLmltYXNrRWxlbWVudCA9IERFRkFVTFRfSU1BU0tfRUxFTUVOVDtcclxuXHJcbiAgICBpZiAoIWNoYW5nZXMuaW1hc2sgfHwgIXRoaXMuX3ZpZXdJbml0aWFsaXplZCkgcmV0dXJuO1xyXG5cclxuICAgIGlmICh0aGlzLmltYXNrKSB7XHJcbiAgICAgIGlmICh0aGlzLm1hc2tSZWYpIHRoaXMubWFza1JlZi51cGRhdGVPcHRpb25zKHRoaXMuaW1hc2spO1xyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLmluaXRNYXNrKCk7XHJcbiAgICAgICAgdGhpcy5vbkNoYW5nZSh0aGlzLm1hc2tWYWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGVzdHJveU1hc2soKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlc3Ryb3lNYXNrICgpIHtcclxuICAgIGlmICh0aGlzLm1hc2tSZWYpIHtcclxuICAgICAgdGhpcy5tYXNrUmVmLmRlc3Ryb3koKTtcclxuICAgICAgZGVsZXRlIHRoaXMubWFza1JlZjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95ICgpIHtcclxuICAgIHRoaXMuZGVzdHJveU1hc2soKTtcclxuICAgIHRoaXMuYWNjZXB0LmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmNvbXBsZXRlLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG5cclxuICBiZWdpbldyaXRlICh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLl93cml0aW5nID0gdHJ1ZTtcclxuICAgIHRoaXMuX3dyaXRpbmdWYWx1ZSA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgZW5kV3JpdGUgKCk6IGFueSB7XHJcbiAgICB0aGlzLl93cml0aW5nID0gZmFsc2U7XHJcbiAgICByZXR1cm4gdGhpcy5fd3JpdGluZ1ZhbHVlO1xyXG4gIH1cclxuXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICB2YWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xyXG5cclxuICAgIGlmICh0aGlzLm1hc2tSZWYpIHtcclxuICAgICAgdGhpcy5iZWdpbldyaXRlKHZhbHVlKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLm1hc2tWYWx1ZSAhPT0gdmFsdWUgfHxcclxuICAgICAgICAvLyBoYW5kbGUgY2FzZXMgbGlrZSBOdW1iZXIoJycpID09PSAwLFxyXG4gICAgICAgIC8vIGZvciBkZXRhaWxzIHNlZSBodHRwczovL2dpdGh1Yi5jb20vdU5tQW5OZVIvaW1hc2tqcy9pc3N1ZXMvMTM0XHJcbiAgICAgICAgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycgJiYgdGhpcy5tYXNrUmVmLnZhbHVlID09PSAnJykgJiZcclxuICAgICAgICAgICF0aGlzLm1hc2tSZWYuZWwuaXNBY3RpdmVcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5tYXNrVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbGVtZW50LCAndmFsdWUnLCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfb25BY2NlcHQgKCkge1xyXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLm1hc2tWYWx1ZTtcclxuICAgIC8vIGlmIHZhbHVlIHdhcyBub3QgY2hhbmdlZCBkdXJpbmcgd3JpdGluZyBkb24ndCBmaXJlIGV2ZW50c1xyXG4gICAgLy8gZm9yIGRldGFpbHMgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS91Tm1Bbk5lUi9pbWFza2pzL2lzc3Vlcy8xMzZcclxuICAgIGlmICh0aGlzLl93cml0aW5nICYmIHZhbHVlID09PSB0aGlzLmVuZFdyaXRlKCkpIHJldHVybjtcclxuICAgIHRoaXMub25DaGFuZ2UodmFsdWUpO1xyXG4gICAgdGhpcy5hY2NlcHQuZW1pdCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBfb25Db21wbGV0ZSAoKSB7XHJcbiAgICB0aGlzLmNvbXBsZXRlLmVtaXQodGhpcy5tYXNrVmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0TWFzayAoKSB7XHJcbiAgICB0aGlzLm1hc2tSZWYgPSBJTWFzayh0aGlzLmVsZW1lbnQsIHRoaXMuaW1hc2sgYXMgT3B0cylcclxuICAgICAgLm9uKCdhY2NlcHQnLCB0aGlzLl9vbkFjY2VwdC5iaW5kKHRoaXMpKVxyXG4gICAgICAub24oJ2NvbXBsZXRlJywgdGhpcy5fb25Db21wbGV0ZS5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIHNldERpc2FibGVkU3RhdGUgKGlzRGlzYWJsZWQ6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX3JlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuZWxlbWVudCwgJ2Rpc2FibGVkJywgaXNEaXNhYmxlZClcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHZvaWQpOiB2b2lkIHsgdGhpcy5vbkNoYW5nZSA9IGZuIH1cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQgeyB0aGlzLm9uVG91Y2hlZCA9IGZuIH1cclxuXHJcbiAgX2hhbmRsZUlucHV0KHZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgIC8vIGlmIG1hc2sgaXMgYXR0YWNoZWQgYWxsIGlucHV0IGdvZXMgdGhyb3cgbWFza1xyXG4gICAgaWYgKHRoaXMubWFza1JlZikgcmV0dXJuO1xyXG5cclxuICAgIGlmICghdGhpcy5fY29tcG9zaXRpb25Nb2RlIHx8ICh0aGlzLl9jb21wb3NpdGlvbk1vZGUgJiYgIXRoaXMuX2NvbXBvc2luZykpIHtcclxuICAgICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY29tcG9zaXRpb25TdGFydCgpOiB2b2lkIHsgdGhpcy5fY29tcG9zaW5nID0gdHJ1ZTsgfVxyXG5cclxuICBfY29tcG9zaXRpb25FbmQodmFsdWU6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5fY29tcG9zaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLl9jb21wb3NpdGlvbk1vZGUgJiYgdGhpcy5faGFuZGxlSW5wdXQodmFsdWUpO1xyXG4gIH1cclxufVxyXG4iXX0=